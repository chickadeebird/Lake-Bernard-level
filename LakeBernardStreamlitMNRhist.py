import streamlit as st
import pandas as pd
import requests
from env_canada import ECHistorical
import asyncio
from datetime import datetime, timezone
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import numpy as np


def compose_date(years, months=1, days=1, weeks=None, hours=None, minutes=None,
                 seconds=None, milliseconds=None, microseconds=None, nanoseconds=None):
    years = np.asarray(years) - 1970
    months = np.asarray(months) - 1
    days = np.asarray(days) - 1
    types = ('<M8[Y]', '<m8[M]', '<m8[D]', '<m8[W]', '<m8[h]',
             '<m8[m]', '<m8[s]', '<m8[ms]', '<m8[us]', '<m8[ns]')
    vals = (years, months, days, weeks, hours, minutes, seconds,
            milliseconds, microseconds, nanoseconds)
    return sum(np.asarray(v, dtype=t) for t, v in zip(types, vals)
               if v is not None)


@st.cache_data
def get_target_values():
    target_values_array = [
        [0, 329.7, 329.3, 329.2, 329.2, 329.2, 329.1, 329.0],
        [1, 329.7, 329.3, 329.2, 329.2, 329.2, 329.1, 329.0],
        [2, 329.7, 329.3, 329.2, 329.2, 329.2, 329.1, 329.0],
        [3, 329.7, 329.3, 329.2, 329.2, 329.2, 329.09, 328.99],
        [4, 329.7, 329.3, 329.2, 329.2, 329.2, 329.09, 328.99],
        [5, 329.7, 329.3, 329.2, 329.2, 329.2, 329.09, 328.99],
        [6, 329.7, 329.3, 329.2, 329.2, 329.2, 329.09, 328.99],
        [7, 329.7, 329.3, 329.2, 329.2, 329.2, 329.09, 328.99],
        [8, 329.7, 329.3, 329.2, 329.2, 329.2, 329.08, 328.98],
        [9, 329.7, 329.3, 329.2, 329.2, 329.2, 329.08, 328.98],
        [10, 329.7, 329.3, 329.2, 329.2, 329.2, 329.08, 328.98],
        [11, 329.7, 329.3, 329.2, 329.2, 329.2, 329.08, 328.98],
        [12, 329.7, 329.3, 329.2, 329.2, 329.2, 329.08, 328.98],
        [13, 329.7, 329.3, 329.2, 329.2, 329.2, 329.07, 328.97],
        [14, 329.7, 329.3, 329.2, 329.2, 329.2, 329.07, 328.97],
        [15, 329.7, 329.3, 329.2, 329.2, 329.2, 329.07, 328.97],
        [16, 329.7, 329.3, 329.2, 329.2, 329.2, 329.07, 328.97],
        [17, 329.7, 329.3, 329.2, 329.2, 329.2, 329.07, 328.97],
        [18, 329.7, 329.3, 329.2, 329.2, 329.2, 329.06, 328.96],
        [19, 329.7, 329.3, 329.2, 329.2, 329.2, 329.06, 328.96],
        [20, 329.7, 329.3, 329.2, 329.2, 329.2, 329.06, 328.96],
        [21, 329.7, 329.3, 329.2, 329.2, 329.2, 329.06, 328.96],
        [22, 329.7, 329.3, 329.2, 329.2, 329.2, 329.06, 328.96],
        [23, 329.7, 329.3, 329.2, 329.2, 329.2, 329.05, 328.95],
        [24, 329.7, 329.3, 329.2, 329.2, 329.2, 329.05, 328.95],
        [25, 329.7, 329.3, 329.2, 329.2, 329.2, 329.05, 328.95],
        [26, 329.7, 329.3, 329.2, 329.2, 329.2, 329.05, 328.95],
        [27, 329.7, 329.3, 329.2, 329.2, 329.2, 329.05, 328.95],
        [28, 329.7, 329.3, 329.2, 329.2, 329.2, 329.04, 328.94],
        [29, 329.7, 329.3, 329.2, 329.2, 329.2, 329.04, 328.94],
        [30, 329.7, 329.3, 329.2, 329.2, 329.2, 329.04, 328.94],
        [31, 329.7, 329.3, 329.2, 329.2, 329.2, 329.04, 328.94],
        [32, 329.7, 329.3, 329.2, 329.2, 329.2, 329.04, 328.94],
        [33, 329.7, 329.3, 329.2, 329.2, 329.2, 329.03, 328.93],
        [34, 329.7, 329.3, 329.2, 329.2, 329.2, 329.03, 328.93],
        [35, 329.7, 329.3, 329.2, 329.2, 329.2, 329.03, 328.93],
        [36, 329.7, 329.3, 329.2, 329.2, 329.2, 329.03, 328.93],
        [37, 329.7, 329.3, 329.2, 329.2, 329.2, 329.02, 328.92],
        [38, 329.7, 329.3, 329.2, 329.2, 329.2, 329.02, 328.92],
        [39, 329.7, 329.3, 329.2, 329.2, 329.2, 329.02, 328.92],
        [40, 329.7, 329.3, 329.2, 329.2, 329.2, 329.02, 328.92],
        [41, 329.7, 329.3, 329.2, 329.2, 329.2, 329.02, 328.92],
        [42, 329.7, 329.3, 329.2, 329.2, 329.2, 329.01, 328.91],
        [43, 329.7, 329.3, 329.2, 329.2, 329.2, 329.01, 328.91],
        [44, 329.7, 329.3, 329.2, 329.2, 329.2, 329.01, 328.91],
        [45, 329.7, 329.3, 329.2, 329.2, 329.2, 329.01, 328.91],
        [46, 329.7, 329.29, 329.19, 329.19, 329.19, 329.01, 328.91],
        [47, 329.7, 329.29, 329.19, 329.19, 329.19, 329.0, 328.9],
        [48, 329.7, 329.28, 329.18, 329.18, 329.18, 329.0, 328.9],
        [49, 329.7, 329.28, 329.18, 329.18, 329.18, 329.0, 328.9],
        [50, 329.7, 329.27, 329.17, 329.17, 329.17, 329.0, 328.9],
        [51, 329.7, 329.27, 329.17, 329.17, 329.17, 329.0, 328.9],
        [52, 329.7, 329.26, 329.16, 329.16, 329.16, 328.99, 328.89],
        [53, 329.7, 329.26, 329.16, 329.16, 329.16, 328.99, 328.89],
        [54, 329.7, 329.25, 329.15, 329.15, 329.15, 328.99, 328.89],
        [55, 329.7, 329.25, 329.15, 329.15, 329.15, 328.99, 328.89],
        [56, 329.7, 329.24, 329.14, 329.14, 329.14, 328.99, 328.89],
        [57, 329.7, 329.24, 329.14, 329.14, 329.14, 328.98, 328.88],
        [58, 329.7, 329.23, 329.13, 329.13, 329.13, 328.98, 328.88],
        [59, 329.7, 329.23, 329.13, 329.13, 329.13, 328.98, 328.88],
        [60, 329.7, 329.22, 329.12, 329.12, 329.12, 328.98, 328.88],
        [61, 329.7, 329.21, 329.11, 329.11, 329.11, 328.98, 328.88],
        [62, 329.7, 329.21, 329.11, 329.11, 329.11, 328.97, 328.87],
        [63, 329.7, 329.2, 329.1, 329.1, 329.1, 328.97, 328.87],
        [64, 329.7, 329.2, 329.1, 329.1, 329.1, 328.97, 328.87],
        [65, 329.7, 329.19, 329.09, 329.09, 329.09, 328.97, 328.87],
        [66, 329.7, 329.19, 329.09, 329.09, 329.09, 328.97, 328.87],
        [67, 329.7, 329.18, 329.08, 329.08, 329.08, 328.96, 328.86],
        [68, 329.7, 329.18, 329.08, 329.08, 329.08, 328.96, 328.86],
        [69, 329.7, 329.17, 329.07, 329.07, 329.07, 328.96, 328.86],
        [70, 329.7, 329.17, 329.07, 329.07, 329.07, 328.96, 328.86],
        [71, 329.7, 329.16, 329.06, 329.06, 329.06, 328.96, 328.86],
        [72, 329.7, 329.16, 329.06, 329.06, 329.06, 328.95, 328.85],
        [73, 329.7, 329.15, 329.05, 329.05, 329.05, 328.95, 328.85],
        [74, 329.7, 329.18, 329.05, 329.05, 329.05, 328.95, 328.85],
        [75, 329.7, 329.2, 329.05, 329.05, 329.05, 328.95, 328.85],
        [76, 329.7, 329.23, 329.05, 329.05, 329.05, 328.95, 328.85],
        [77, 329.7, 329.25, 329.05, 329.05, 329.05, 328.95, 328.85],
        [78, 329.7, 329.28, 329.05, 329.05, 329.05, 328.95, 328.85],
        [79, 329.7, 329.3, 329.05, 329.05, 329.05, 328.95, 328.85],
        [80, 329.7, 329.33, 329.05, 329.05, 329.05, 328.95, 328.85],
        [81, 329.7, 329.35, 329.05, 329.05, 329.05, 328.95, 328.85],
        [82, 329.7, 329.38, 329.05, 329.05, 329.05, 328.95, 328.85],
        [83, 329.7, 329.4, 329.05, 329.05, 329.05, 328.95, 328.85],
        [84, 329.7, 329.43, 329.05, 329.05, 329.05, 328.95, 328.85],
        [85, 329.7, 329.45, 329.05, 329.05, 329.05, 328.95, 328.85],
        [86, 329.7, 329.48, 329.05, 329.05, 329.05, 328.95, 328.85],
        [87, 329.7, 329.5, 329.05, 329.05, 329.05, 328.95, 328.85],
        [88, 329.7, 329.53, 329.05, 329.05, 329.05, 328.95, 328.85],
        [89, 329.7, 329.55, 329.05, 329.05, 329.05, 328.95, 328.85],
        [90, 329.7, 329.55, 329.07, 329.07, 329.07, 328.95, 328.85],
        [91, 329.7, 329.55, 329.08, 329.08, 329.08, 328.95, 328.85],
        [92, 329.7, 329.55, 329.1, 329.1, 329.1, 328.95, 328.85],
        [93, 329.7, 329.55, 329.11, 329.11, 329.11, 328.95, 328.85],
        [94, 329.7, 329.55, 329.13, 329.13, 329.13, 328.95, 328.85],
        [95, 329.7, 329.55, 329.14, 329.14, 329.14, 328.95, 328.85],
        [96, 329.7, 329.55, 329.16, 329.16, 329.16, 328.95, 328.85],
        [97, 329.7, 329.55, 329.17, 329.17, 329.17, 328.95, 328.85],
        [98, 329.7, 329.55, 329.19, 329.19, 329.19, 328.95, 328.85],
        [99, 329.7, 329.55, 329.2, 329.2, 329.2, 328.95, 328.85],
        [100, 329.7, 329.55, 329.22, 329.22, 329.22, 328.95, 328.85],
        [101, 329.7, 329.55, 329.23, 329.23, 329.23, 328.95, 328.85],
        [102, 329.7, 329.55, 329.25, 329.25, 329.25, 328.95, 328.85],
        [103, 329.7, 329.55, 329.26, 329.26, 329.26, 328.95, 328.85],
        [104, 329.7, 329.55, 329.28, 329.28, 329.28, 328.95, 328.85],
        [105, 329.7, 329.55, 329.29, 329.29, 329.29, 328.96, 328.86],
        [106, 329.7, 329.55, 329.31, 329.31, 329.31, 328.97, 328.86],
        [107, 329.7, 329.55, 329.32, 329.32, 329.32, 328.98, 328.87],
        [108, 329.7, 329.55, 329.34, 329.34, 329.34, 328.99, 328.88],
        [109, 329.7, 329.55, 329.35, 329.35, 329.35, 329.0, 328.88],
        [110, 329.7, 329.55, 329.37, 329.37, 329.37, 329.01, 328.89],
        [111, 329.7, 329.55, 329.38, 329.38, 329.38, 329.02, 328.9],
        [112, 329.7, 329.55, 329.4, 329.4, 329.4, 329.03, 328.9],
        [113, 329.7, 329.55, 329.41, 329.41, 329.41, 329.04, 328.91],
        [114, 329.7, 329.55, 329.43, 329.43, 329.43, 329.05, 328.92],
        [115, 329.7, 329.55, 329.44, 329.44, 329.44, 329.06, 328.92],
        [116, 329.7, 329.55, 329.46, 329.46, 329.46, 329.07, 328.93],
        [117, 329.7, 329.55, 329.47, 329.47, 329.47, 329.08, 328.94],
        [118, 329.7, 329.55, 329.49, 329.49, 329.49, 329.09, 328.94],
        [119, 329.7, 329.55, 329.5, 329.5, 329.5, 329.1, 328.95],
        [120, 329.7, 329.55, 329.5, 329.5, 329.5, 329.11, 328.95],
        [121, 329.7, 329.55, 329.5, 329.5, 329.5, 329.12, 328.96],
        [122, 329.7, 329.55, 329.5, 329.5, 329.5, 329.13, 328.97],
        [123, 329.7, 329.55, 329.5, 329.5, 329.5, 329.14, 328.97],
        [124, 329.7, 329.55, 329.5, 329.5, 329.5, 329.15, 328.98],
        [125, 329.7, 329.55, 329.5, 329.5, 329.5, 329.16, 328.99],
        [126, 329.7, 329.55, 329.5, 329.5, 329.5, 329.17, 328.99],
        [127, 329.7, 329.55, 329.5, 329.5, 329.5, 329.18, 329.0],
        [128, 329.7, 329.55, 329.5, 329.5, 329.5, 329.19, 329.01],
        [129, 329.7, 329.55, 329.5, 329.5, 329.5, 329.2, 329.01],
        [130, 329.7, 329.55, 329.5, 329.5, 329.5, 329.21, 329.02],
        [131, 329.7, 329.55, 329.5, 329.5, 329.5, 329.22, 329.03],
        [132, 329.7, 329.55, 329.5, 329.5, 329.5, 329.23, 329.03],
        [133, 329.7, 329.55, 329.5, 329.5, 329.5, 329.24, 329.04],
        [134, 329.7, 329.55, 329.5, 329.5, 329.5, 329.25, 329.05],
        [135, 329.7, 329.55, 329.5, 329.5, 329.5, 329.25, 329.05],
        [136, 329.7, 329.55, 329.49, 329.49, 329.49, 329.26, 329.06],
        [137, 329.7, 329.55, 329.49, 329.49, 329.49, 329.26, 329.07],
        [138, 329.7, 329.55, 329.49, 329.49, 329.49, 329.26, 329.07],
        [139, 329.7, 329.55, 329.48, 329.48, 329.48, 329.27, 329.08],
        [140, 329.7, 329.55, 329.48, 329.48, 329.48, 329.27, 329.09],
        [141, 329.7, 329.55, 329.48, 329.48, 329.48, 329.27, 329.09],
        [142, 329.7, 329.55, 329.48, 329.48, 329.48, 329.28, 329.1],
        [143, 329.7, 329.55, 329.47, 329.47, 329.47, 329.28, 329.11],
        [144, 329.7, 329.55, 329.47, 329.47, 329.47, 329.28, 329.11],
        [145, 329.7, 329.55, 329.47, 329.47, 329.47, 329.29, 329.12],
        [146, 329.7, 329.55, 329.46, 329.46, 329.46, 329.29, 329.13],
        [147, 329.7, 329.55, 329.46, 329.46, 329.46, 329.29, 329.13],
        [148, 329.7, 329.55, 329.46, 329.46, 329.46, 329.3, 329.14],
        [149, 329.7, 329.55, 329.45, 329.45, 329.45, 329.3, 329.15],
        [150, 329.7, 329.55, 329.45, 329.45, 329.45, 329.3, 329.15],
        [151, 329.7, 329.55, 329.5, 329.45, 329.45, 329.3, 329.16],
        [152, 329.7, 329.55, 329.5, 329.45, 329.45, 329.31, 329.16],
        [153, 329.7, 329.55, 329.5, 329.45, 329.45, 329.31, 329.17],
        [154, 329.7, 329.55, 329.5, 329.45, 329.45, 329.31, 329.18],
        [155, 329.7, 329.55, 329.5, 329.45, 329.45, 329.32, 329.18],
        [156, 329.7, 329.55, 329.5, 329.45, 329.45, 329.32, 329.19],
        [157, 329.7, 329.55, 329.5, 329.45, 329.44, 329.32, 329.2],
        [158, 329.7, 329.55, 329.5, 329.45, 329.44, 329.33, 329.2],
        [159, 329.7, 329.55, 329.5, 329.45, 329.44, 329.33, 329.21],
        [160, 329.7, 329.55, 329.5, 329.45, 329.44, 329.33, 329.22],
        [161, 329.7, 329.55, 329.5, 329.45, 329.44, 329.34, 329.22],
        [162, 329.7, 329.55, 329.5, 329.45, 329.44, 329.34, 329.23],
        [163, 329.7, 329.55, 329.5, 329.45, 329.44, 329.34, 329.24],
        [164, 329.7, 329.55, 329.5, 329.45, 329.44, 329.35, 329.24],
        [165, 329.7, 329.55, 329.5, 329.45, 329.44, 329.35, 329.25],
        [166, 329.7, 329.55, 329.5, 329.45, 329.44, 329.35, 329.25],
        [167, 329.7, 329.55, 329.5, 329.45, 329.44, 329.35, 329.25],
        [168, 329.7, 329.55, 329.5, 329.45, 329.44, 329.35, 329.25],
        [169, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [170, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [171, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [172, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [173, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [174, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [175, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [176, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [177, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [178, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [179, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [180, 329.7, 329.55, 329.5, 329.45, 329.43, 329.35, 329.25],
        [181, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [182, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [183, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [184, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [185, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [186, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [187, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [188, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [189, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [190, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [191, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [192, 329.7, 329.55, 329.5, 329.45, 329.42, 329.35, 329.25],
        [193, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [194, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [195, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [196, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [197, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [198, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [199, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [200, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [201, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [202, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [203, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [204, 329.7, 329.55, 329.5, 329.45, 329.41, 329.35, 329.25],
        [205, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [206, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [207, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [208, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [209, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [210, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [211, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [212, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [213, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [214, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [215, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [216, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [217, 329.7, 329.55, 329.5, 329.45, 329.4, 329.35, 329.25],
        [218, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [219, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [220, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [221, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [222, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [223, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [224, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [225, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [226, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [227, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [228, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [229, 329.7, 329.55, 329.5, 329.45, 329.39, 329.35, 329.25],
        [230, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [231, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [232, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [233, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [234, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [235, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [236, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [237, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [238, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [239, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [240, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [241, 329.7, 329.55, 329.5, 329.45, 329.38, 329.35, 329.25],
        [242, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [243, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [244, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [245, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [246, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [247, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [248, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [249, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [250, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [251, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [252, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [253, 329.7, 329.55, 329.5, 329.45, 329.37, 329.35, 329.25],
        [254, 329.7, 329.55, 329.5, 329.45, 329.36, 329.35, 329.25],
        [255, 329.7, 329.55, 329.5, 329.45, 329.36, 329.35, 329.25],
        [256, 329.7, 329.55, 329.5, 329.45, 329.36, 329.35, 329.25],
        [257, 329.7, 329.55, 329.5, 329.45, 329.36, 329.35, 329.25],
        [258, 329.7, 329.55, 0.0, 329.44, 329.36, 329.34, 329.24],
        [259, 329.7, 329.55, 0.0, 329.44, 329.36, 329.34, 329.24],
        [260, 329.7, 329.55, 0.0, 329.43, 329.36, 329.33, 329.23],
        [261, 329.7, 329.55, 0.0, 329.42, 329.36, 329.32, 329.22],
        [262, 329.7, 329.55, 0.0, 329.42, 329.36, 329.32, 329.22],
        [263, 329.7, 329.55, 0.0, 329.41, 329.36, 329.31, 329.21],
        [264, 329.7, 329.54, 0.0, 329.4, 329.36, 329.3, 329.2],
        [265, 329.7, 329.54, 0.0, 329.4, 329.36, 329.3, 329.2],
        [266, 329.7, 329.53, 0.0, 329.39, 329.35, 329.29, 329.19],
        [267, 329.7, 329.53, 0.0, 329.38, 329.35, 329.28, 329.18],
        [268, 329.7, 329.52, 0.0, 329.38, 329.35, 329.28, 329.18],
        [269, 329.7, 329.52, 0.0, 329.37, 329.35, 329.27, 329.17],
        [270, 329.7, 329.51, 0.0, 329.36, 329.35, 329.26, 329.16],
        [271, 329.7, 329.51, 0.0, 329.36, 329.35, 329.26, 329.16],
        [272, 329.7, 329.5, 0.0, 329.35, 329.35, 329.25, 329.15],
        [273, 329.7, 329.5, 329.34, 329.34, 329.34, 329.24, 329.14],
        [274, 329.7, 329.49, 329.34, 329.34, 329.34, 329.24, 329.14],
        [275, 329.7, 329.49, 329.33, 329.33, 329.33, 329.23, 329.13],
        [276, 329.7, 329.48, 329.32, 329.32, 329.32, 329.22, 329.12],
        [277, 329.7, 329.48, 329.32, 329.32, 329.32, 329.22, 329.12],
        [278, 329.7, 329.47, 329.31, 329.31, 329.31, 329.21, 329.11],
        [279, 329.7, 329.47, 329.3, 329.3, 329.3, 329.2, 329.1],
        [280, 329.7, 329.46, 329.3, 329.3, 329.3, 329.2, 329.1],
        [281, 329.7, 329.46, 329.29, 329.29, 329.29, 329.19, 329.09],
        [282, 329.7, 329.45, 329.28, 329.28, 329.28, 329.18, 329.08],
        [283, 329.7, 329.45, 329.28, 329.28, 329.28, 329.18, 329.08],
        [284, 329.7, 329.44, 329.27, 329.27, 329.27, 329.17, 329.07],
        [285, 329.7, 329.44, 329.26, 329.26, 329.26, 329.16, 329.06],
        [286, 329.7, 329.43, 329.26, 329.26, 329.26, 329.16, 329.06],
        [287, 329.7, 329.43, 329.25, 329.25, 329.25, 329.15, 329.05],
        [288, 329.7, 329.42, 329.25, 329.25, 329.25, 329.15, 329.05],
        [289, 329.7, 329.42, 329.25, 329.25, 329.25, 329.15, 329.05],
        [290, 329.7, 329.41, 329.25, 329.25, 329.25, 329.15, 329.05],
        [291, 329.7, 329.41, 329.25, 329.25, 329.25, 329.15, 329.05],
        [292, 329.7, 329.4, 329.25, 329.25, 329.25, 329.15, 329.05],
        [293, 329.7, 329.4, 329.25, 329.25, 329.25, 329.15, 329.05],
        [294, 329.7, 329.39, 329.25, 329.25, 329.25, 329.15, 329.05],
        [295, 329.7, 329.39, 329.24, 329.24, 329.24, 329.14, 329.04],
        [296, 329.7, 329.38, 329.24, 329.24, 329.24, 329.14, 329.04],
        [297, 329.7, 329.38, 329.24, 329.24, 329.24, 329.14, 329.04],
        [298, 329.7, 329.37, 329.24, 329.24, 329.24, 329.14, 329.04],
        [299, 329.7, 329.37, 329.24, 329.24, 329.24, 329.14, 329.04],
        [300, 329.7, 329.36, 329.24, 329.24, 329.24, 329.14, 329.04],
        [301, 329.7, 329.36, 329.24, 329.24, 329.24, 329.14, 329.04],
        [302, 329.7, 329.35, 329.24, 329.24, 329.24, 329.14, 329.04],
        [303, 329.7, 329.35, 329.24, 329.24, 329.24, 329.14, 329.04],
        [304, 329.7, 329.35, 329.24, 329.24, 329.24, 329.14, 329.04],
        [305, 329.7, 329.35, 329.24, 329.24, 329.24, 329.14, 329.04],
        [306, 329.7, 329.35, 329.24, 329.24, 329.24, 329.14, 329.04],
        [307, 329.7, 329.35, 329.24, 329.24, 329.24, 329.14, 329.04],
        [308, 329.7, 329.35, 329.24, 329.24, 329.24, 329.14, 329.04],
        [309, 329.7, 329.35, 329.24, 329.24, 329.24, 329.14, 329.04],
        [310, 329.7, 329.34, 329.24, 329.24, 329.24, 329.14, 329.04],
        [311, 329.7, 329.34, 329.23, 329.23, 329.23, 329.13, 329.03],
        [312, 329.7, 329.34, 329.23, 329.23, 329.23, 329.13, 329.03],
        [313, 329.7, 329.34, 329.23, 329.23, 329.23, 329.13, 329.03],
        [314, 329.7, 329.34, 329.23, 329.23, 329.23, 329.13, 329.03],
        [315, 329.7, 329.34, 329.23, 329.23, 329.23, 329.13, 329.03],
        [316, 329.7, 329.34, 329.23, 329.23, 329.23, 329.13, 329.03],
        [317, 329.7, 329.34, 329.23, 329.23, 329.23, 329.13, 329.03],
        [318, 329.7, 329.34, 329.23, 329.23, 329.23, 329.13, 329.03],
        [319, 329.7, 329.34, 329.23, 329.23, 329.23, 329.13, 329.03],
        [320, 329.7, 329.34, 329.23, 329.23, 329.23, 329.13, 329.03],
        [321, 329.7, 329.34, 329.23, 329.23, 329.23, 329.13, 329.03],
        [322, 329.7, 329.33, 329.23, 329.23, 329.23, 329.13, 329.03],
        [323, 329.7, 329.33, 329.23, 329.23, 329.23, 329.13, 329.03],
        [324, 329.7, 329.33, 329.23, 329.23, 329.23, 329.13, 329.03],
        [325, 329.7, 329.33, 329.23, 329.23, 329.23, 329.13, 329.03],
        [326, 329.7, 329.33, 329.22, 329.22, 329.22, 329.12, 329.02],
        [327, 329.7, 329.33, 329.22, 329.22, 329.22, 329.12, 329.02],
        [328, 329.7, 329.33, 329.22, 329.22, 329.22, 329.12, 329.02],
        [329, 329.7, 329.33, 329.22, 329.22, 329.22, 329.12, 329.02],
        [330, 329.7, 329.33, 329.22, 329.22, 329.22, 329.12, 329.02],
        [331, 329.7, 329.33, 329.22, 329.22, 329.22, 329.12, 329.02],
        [332, 329.7, 329.33, 329.22, 329.22, 329.22, 329.12, 329.02],
        [333, 329.7, 329.33, 329.22, 329.22, 329.22, 329.12, 329.02],
        [334, 329.7, 329.32, 329.22, 329.22, 329.22, 329.12, 329.02],
        [335, 329.7, 329.32, 329.22, 329.22, 329.22, 329.12, 329.02],
        [336, 329.7, 329.32, 329.22, 329.22, 329.22, 329.12, 329.02],
        [337, 329.7, 329.32, 329.22, 329.22, 329.22, 329.12, 329.02],
        [338, 329.7, 329.32, 329.22, 329.22, 329.22, 329.12, 329.02],
        [339, 329.7, 329.32, 329.22, 329.22, 329.22, 329.12, 329.02],
        [340, 329.7, 329.32, 329.22, 329.22, 329.22, 329.12, 329.02],
        [341, 329.7, 329.32, 329.21, 329.21, 329.21, 329.11, 329.01],
        [342, 329.7, 329.32, 329.21, 329.21, 329.21, 329.11, 329.01],
        [343, 329.7, 329.32, 329.21, 329.21, 329.21, 329.11, 329.01],
        [344, 329.7, 329.32, 329.21, 329.21, 329.21, 329.11, 329.01],
        [345, 329.7, 329.32, 329.21, 329.21, 329.21, 329.11, 329.01],
        [346, 329.7, 329.31, 329.21, 329.21, 329.21, 329.11, 329.01],
        [347, 329.7, 329.31, 329.21, 329.21, 329.21, 329.11, 329.01],
        [348, 329.7, 329.31, 329.21, 329.21, 329.21, 329.11, 329.01],
        [349, 329.7, 329.31, 329.21, 329.21, 329.21, 329.11, 329.01],
        [350, 329.7, 329.31, 329.21, 329.21, 329.21, 329.11, 329.01],
        [351, 329.7, 329.31, 329.21, 329.21, 329.21, 329.11, 329.01],
        [352, 329.7, 329.31, 329.21, 329.21, 329.21, 329.11, 329.01],
        [353, 329.7, 329.31, 329.21, 329.21, 329.21, 329.11, 329.01],
        [354, 329.7, 329.31, 329.21, 329.21, 329.21, 329.11, 329.01],
        [355, 329.7, 329.31, 329.21, 329.21, 329.21, 329.11, 329.01],
        [356, 329.7, 329.31, 329.21, 329.21, 329.21, 329.11, 329.01],
        [357, 329.7, 329.31, 329.2, 329.2, 329.2, 329.1, 329.0],
        [358, 329.7, 329.3, 329.2, 329.2, 329.2, 329.1, 329.0],
        [359, 329.7, 329.3, 329.2, 329.2, 329.2, 329.1, 329.0],
        [360, 329.7, 329.3, 329.2, 329.2, 329.2, 329.1, 329.0],
        [361, 329.7, 329.3, 329.2, 329.2, 329.2, 329.1, 329.0],
        [362, 329.7, 329.3, 329.2, 329.2, 329.2, 329.1, 329.0],
        [363, 329.7, 329.3, 329.2, 329.2, 329.2, 329.1, 329.0],
        [364, 329.7, 329.3, 329.2, 329.2, 329.2, 329.1, 329.0],
        [365, 329.7, 329.3, 329.2, 329.2, 329.2, 329.1, 329.0]
    ]

    df = pd.DataFrame(target_values_array,
                      columns=['Day', 'Top of High', 'Top of Normal', 'Top of BMP', 'Target', 'Best Practice', 'Bottom of Normal', 'Bottom of Low'])

    df['Day'] += 1
    todays_date = datetime.today()
    year = int(todays_date.year)
    df['Year'] = year
    df['Day'] = df['Day'].astype(int)
    df['Date'] = compose_date(df['Year'], days=df['Day'])
    # df.loc[-1,'Date'] = df.loc[-2,'Date']
    df['Month'] = df['Date'].dt.strftime('%b')

    return df


@st.cache_data
def get_historical_data():
    historical_water_data_array = [
        [1, 8.296121528, 8.356, 8.239, 8.221, 8.246, 8.333],
        [2, 8.297447917, 8.35, 8.235, 8.217, 8.241, 8.329],
        [3, 8.299899306, 8.344, 8.231, 8.211, 8.239, 8.33],
        [4, 8.319295139, 8.339, 8.225, 8.206, 8.239, 8.324],
        [5, 8.331173611, 8.337, 8.221, 8.2, 8.234, 8.317],
        [6, 8.332197917, 8.339, 8.215, 8.2, 8.229, 8.311],
        [7, 8.330239583, 8.335, 8.211, 8.199, 8.224, 8.305],
        [8, 8.328364583, 8.33, 8.205, 8.2, 8.23, 8.306],
        [9, 8.327232639, 8.327, 8.2, 8.194, 8.228, 8.303],
        [10, 8.325125, 8.323, 8.195, 8.19, 8.224, 8.298],
        [11, 8.326850694, 8.317, 8.19, 8.204, 8.218, 8.303],
        [12, 8.332302083, 8.314, 8.187, 8.231, 8.212, 8.34],
        [13, 8.329604167, 8.31, 8.185, 8.22, 8.207, 8.349],
        [14, 8.326923611, 8.306, 8.182, 8.216, 8.201, 8.348],
        [15, 8.323892361, 8.3, 8.177, 8.213, 8.197, 8.348],
        [16, 8.321805556, 8.295, 8.175, 8.211, 8.196, 8.347],
        [17, 8.322409722, 8.293, 8.177, 8.207, 8.19, 8.347],
        [18, 8.320982639, 8.29, 8.173, 8.203, 8.185, 8.346],
        [19, 8.323291667, 8.293, 8.169, 8.209, 8.18, 8.343],
        [20, 8.321364583, 8.29, 8.164, 8.206, 8.171, 8.34],
        [21, 8.319614583, 8.285, 8.164, 8.2, 8.165, 8.336],
        [22, 8.319895833, 8.282, 8.161, 8.196, 8.16, 8.337],
        [23, 8.318652778, 8.28, 8.156, 8.191, 8.165, 8.354],
        [24, 8.3178125, 8.276, 8.151, 8.187, 8.168, 8.356],
        [25, 8.31953125, 8.273, 8.147, 8.187, 8.166, 8.352],
        [26, 8.318753472, 8.268, 8.144, 8.188, 8.161, 8.349],
        [27, 8.317680556, 8.265, 8.142, 8.185, 8.156, 8.345],
        [28, 8.316479167, 8.262, 8.137, 8.181, 8.153, 8.341],
        [29, 8.315868056, 8.258, 8.132, 8.176, 8.155, 8.337],
        [30, 8.314430556, 8.254, 8.128, 8.171, 8.152, 8.33],
        [31, 8.311670139, 8.25, 8.124, 8.167, 8.147, 8.328],
        [32, 8.310791667, 8.246, 8.12, 8.164, 8.142, 8.33],
        [33, 8.314329861, 8.25, 8.115, 8.161, 8.141, 8.326],
        [34, 8.310333333, 8.254, 8.11, 8.157, 8.142, 8.322],
        [35, 8.308222222, 8.25, 8.106, 8.152, 8.145, 8.325],
        [36, 8.308982639, 8.245, 8.108, 8.147, 8.156, 8.321],
        [37, 8.30646875, 8.241, 8.114, 8.143, 8.156, 8.318],
        [38, 8.306729167, 8.237, 8.114, 8.14, 8.155, 8.313],
        [39, 8.303378472, 8.235, 8.114, 8.139, 8.159, 8.309],
        [40, 8.308048611, 8.231, 8.109, 8.131, 8.169, 8.304],
        [41, 8.311215278, 8.229, 8.106, 8.134, 8.151, 8.299],
        [42, 8.309201389, 8.229, 8.103, 8.131, 8.148, 8.298],
        [43, 8.308166667, 8.23, 8.099, 8.127, 8.149, 8.298],
        [44, 8.306048611, 8.226, 8.095, 8.124, 8.164, 8.292],
        [45, 8.305180556, 8.222, 8.094, 8.121, 8.158, 8.288],
        [46, 8.315385417, 8.22, 8.095, 8.116, 8.163, 8.284],
        [47, 8.32153125, 8.219, 8.099, 8.115, 8.162, 8.279],
        [48, 8.32621875, 8.233, 8.093, 8.112, 8.158, 8.274],
        [49, 8.326503472, 8.233, 8.09, 8.112, 8.153, 8.27],
        [50, 8.324260417, 8.234, 8.088, 8.114, 8.147, 8.266],
        [51, 8.323, 8.232, 8.086, 8.11, 8.143, 8.289],
        [52, 8.323694444, 8.229, 8.084, 8.106, 8.143, 8.325],
        [53, 8.323482639, 8.232, 8.085, 8.102, 8.139, 8.335],
        [54, 8.32303125, 8.242, 8.085, 8.099, 8.134, 8.342],
        [55, 8.320583333, 8.238, 8.09, 8.097, 8.142, 8.348],
        [56, 8.319315972, 8.237, 8.097, 8.094, 8.151, 8.353],
        [57, 8.317083333, 8.235, 8.094, 8.09, 8.149, 8.356],
        [58, 8.317326389, 8.233, 8.094, 8.098, 8.146, 8.355],
        [59, 8.318704861, 8.23, 8.095, 8.101, 8.144, 8.355],
        [60, 8.316684028, 8.227, 8.104, 8.095, 8.14, 8.355],
        [61, 8.314430556, 8.225, 8.11, 8.093, 8.139, 8.351],
        [62, 8.312638889, 8.224, 8.098, 8.091, 8.138, 8.348],
        [63, 8.311579861, 8.22, 8.095, 8.089, 8.134, 8.343],
        [64, 8.308916667, 8.217, 8.091, 8.09, 8.13, 8.339],
        [65, 8.304902778, 8.225, 8.088, 8.088, 8.125, 8.335],
        [66, 8.299302083, 8.229, 8.085, 8.086, 8.12, 8.332],
        [67, 8.297760417, 8.232, 8.082, 8.088, 8.115, 8.33],
        [68, 8.295909722, 8.23, 8.081, 8.079, 8.112, 8.328],
        [69, 8.292427083, 8.227, 8.079, 8.079, 8.118, 8.326],
        [70, 8.288559028, 8.225, 8.085, 8.101, 8.125, 8.321],
        [71, 8.285569444, 8.222, 8.093, 8.107, 8.124, 8.316],
        [72, 8.283402778, 8.219, 8.094, 8.112, 8.122, 8.313],
        [73, 8.279663194, 8.217, 8.096, 8.121, 8.123, 8.31],
        [74, 8.276951389, 8.217, 8.096, 8.126, 8.155, 8.305],
        [75, 8.276434028, 8.215, 8.096, 8.127, 8.162, 8.299],
        [76, 8.283305556, 8.214, 8.095, 8.126, 8.167, 8.294],
        [77, 8.284503472, 8.215, 8.095, 8.127, 8.17, 8.289],
        [78, 8.283746528, 8.223, 8.092, 8.127, 8.171, 8.283],
        [79, 8.281239583, 8.236, 8.091, 8.127, 8.171, 8.277],
        [80, 8.280902778, 8.243, 8.091, 8.149, 8.172, 8.272],
        [81, 8.283045139, 8.249, 8.094, 8.157, 8.173, 8.266],
        [82, 8.285263889, 8.253, 8.101, 8.16, 8.17, 8.26],
        [83, 8.286475694, 8.276, 8.116, 8.161, 8.17, 8.254],
        [84, 8.29696875, 8.296, 8.16, 8.162, 8.167, 8.248],
        [85, 8.301208333, 8.307, 8.194, 8.162, 8.165, 8.243],
        [86, 8.302229167, 8.315, 8.214, 8.173, 8.162, 8.241],
        [87, 8.30246875, 8.318, 8.243, 8.183, 8.159, 8.242],
        [88, 8.305006944, 8.32, 8.273, 8.188, 8.158, 8.24],
        [89, 8.304552083, 8.323, 8.285, 8.211, 8.163, 8.237],
        [90, 8.314319444, 8.338, 8.298, 8.244, 8.169, 8.238],
        [91, 8.330184028, 8.347, 8.307, 8.271, 8.166, 8.244],
        [92, 8.334666667, 8.351, 8.308, 8.29, 8.167, 8.242],
        [93, 8.341861111, 8.354, 8.311, 8.304, 8.172, 8.242],
        [94, 8.351663194, 8.356, 8.314, 8.334, 8.171, 8.25],
        [95, 8.400100694, 8.358, 8.313, 8.375, 8.167, 8.251],
        [96, 8.417597222, 8.361, 8.316, 8.392, 8.167, 8.25],
        [97, 8.430947917, 8.385, 8.327, 8.409, 8.169, 8.254],
        [98, 8.441763889, 8.404, 8.341, 8.426, 8.185, 8.25],
        [99, 8.447399306, 8.417, 8.363, 8.438, 8.221, 8.245],
        [100, 8.458510417, 8.425, 8.373, 8.45, 8.246, 8.24],
        [101, 8.475600694, 8.431, 8.383, 8.464, 8.26, 8.236],
        [102, 8.501201389, 8.437, 8.394, 8.472, 8.274, 8.238],
        [103, 8.531520833, 8.451, 8.401, 8.48, 8.29, 8.242],
        [104, 8.559947917, 8.476, 8.411, 8.489, 8.305, 8.24],
        [105, 8.5810625, 8.486, 8.416, 8.498, 8.327, 8.24],
        [106, 8.599458333, 8.489, 8.428, 8.506, 8.337, 8.255],
        [107, 8.621118056, 8.489, 8.436, 8.511, 8.348, 8.254],
        [108, 8.616454861, 8.489, 8.44, 8.517, 8.391, 8.25],
        [109, 8.618604167, 8.494, 8.445, 8.519, 8.478, 8.245],
        [110, 8.619444444, 8.496, 8.45, 8.525, 8.535, 8.241],
        [111, 8.621607639, 8.5, 8.455, 8.531, 8.627, 8.239],
        [112, 8.650989583, 8.505, 8.454, 8.541, 8.684, 8.241],
        [113, 8.660548611, 8.505, 8.456, 8.548, 8.724, 8.248],
        [114, 8.662253472, 8.506, 8.458, 8.551, 8.76, 8.259],
        [115, 8.66571875, 8.524, 8.462, 8.554, 8.777, 8.289],
        [116, 8.663704861, 8.546, 8.465, 8.557, 8.799, 8.328],
        [117, 8.659270833, 8.562, 8.468, 8.562, 8.833, 8.369],
        [118, 8.655104167, 8.568, 8.481, 8.563, 8.842, 8.41],
        [119, 8.661388889, 8.571, 8.493, 8.565, 8.839, 8.43],
        [120, 8.686197917, 8.574, 8.509, 8.573, 8.829, 8.444],
        [121, 8.719611111, 8.576, 8.52, 8.593, 8.834, 8.46],
        [122, 8.737940972, 8.582, 8.53, 8.609, 8.847, 8.483],
        [123, 8.748517361, 8.586, 8.541, 8.615, 8.85, 8.509],
        [124, 8.750194444, 8.593, 8.551, 8.62, 8.848, 8.492],
        [125, 8.744815972, 8.594, 8.559, 8.625, 8.84, 8.553],
        [126, 8.737065972, 8.598, 8.564, 8.625, 8.829, 8.577],
        [127, 8.729638889, 8.598, 8.57, 8.624, 8.818, 8.593],
        [128, 8.718805556, 8.596, 8.573, 8.624, 8.805, 8.601],
        [129, 8.706555556, 8.597, 8.574, 8.626, 8.802, 8.607],
        [130, 8.694041667, 8.595, 8.576, 8.626, 8.801, 8.622],
        [131, 8.682864583, 8.596, 8.58, 8.627, 8.794, 8.631],
        [132, 8.673513889, 8.595, 8.584, 8.627, 8.782, 8.635],
        [133, 8.661020833, 8.594, 8.58, 8.626, 8.774, 8.636],
        [134, 8.645180556, 8.601, 8.577, 8.625, 8.765, 8.637],
        [135, 8.627722222, 8.624, 8.574, 8.624, 8.752, 8.641],
        [136, 8.62465625, 8.628, 8.571, 8.628, 8.738, 8.639],
        [137, 8.607590278, 8.633, 8.568, 8.633, 8.729, 8.641],
        [138, 8.605440972, 8.633, 8.567, 8.633, 8.715, 8.637],
        [139, 8.607614583, 8.634, 8.564, 8.635, 8.71, 8.639],
        [140, 8.632666667, 8.634, 8.562, 8.631, 8.715, 8.658],
        [141, 8.638826389, 8.646, 8.56, 8.628, 8.709, 8.659],
        [142, 8.63496875, 8.65, 8.561, 8.626, 8.697, 8.622],
        [143, 8.631989583, 8.653, 8.566, 8.626, 8.693, 8.575],
        [144, 8.628204861, 8.644, 8.558, 8.625, 8.692, 8.597],
        [145, 8.618288194, 8.63, 8.554, 8.624, 8.684, 8.633],
        [146, 8.610125, 8.629, 8.556, 8.627, 8.681, 8.643],
        [147, 8.602298611, 8.636, 8.557, 8.624, 8.672, 8.641],
        [148, 8.597208333, 8.632, 8.551, 8.621, 8.663, 8.64],
        [149, 8.591145833, 8.623, 8.542, 8.622, 8.654, 8.64],
        [150, 8.585055556, 8.613, 8.535, 8.627, 8.641, 8.633],
        [151, 8.578322917, 8.605, 8.531, 8.632, 8.63, 8.626],
        [152, 8.573625, 8.597, 8.529, 8.629, 8.616, 8.628],
        [153, 8.571652778, 8.589, 8.529, 8.625, 8.599, 8.622],
        [154, 8.560381944, 8.576, 8.528, 8.626, 8.583, 8.608],
        [155, 8.5491875, 8.559, 8.527, 8.629, 8.571, 8.606],
        [156, 8.5436875, 8.549, 8.527, 8.63, 8.565, 8.604],
        [157, 8.54453125, 8.544, 8.529, 8.627, 8.557, 8.599],
        [158, 8.537670139, 8.561, 8.529, 8.625, 8.549, 8.594],
        [159, 8.533170139, 8.574, 8.53, 8.621, 8.536, 8.591],
        [160, 8.532583333, 8.575, 8.534, 8.615, 8.522, 8.586],
        [161, 8.530666667, 8.573, 8.528, 8.612, 8.525, 8.58],
        [162, 8.5363125, 8.567, 8.526, 8.61, 8.546, 8.57],
        [163, 8.579354167, 8.582, 8.522, 8.614, 8.546, 8.566],
        [164, 8.59678125, 8.579, 8.519, 8.603, 8.55, 8.577],
        [165, 8.599486111, 8.573, 8.522, 8.592, 8.553, 8.587],
        [166, 8.601440972, 8.57, 8.526, 8.576, 8.565, 8.584],
        [167, 8.600270833, 8.563, 8.515, 8.572, 8.579, 8.581],
        [168, 8.597145833, 8.553, 8.506, 8.581, 8.579, 8.578],
        [169, 8.594510417, 8.544, 8.506, 8.578, 8.575, 8.58],
        [170, 8.593315972, 8.527, 8.51, 8.575, 8.577, 8.582],
        [171, 8.590225694, 8.522, 8.508, 8.572, 8.586, 8.577],
        [172, 8.587197917, 8.528, 8.505, 8.567, 8.582, 8.574],
        [173, 8.581958042, 8.528, 8.505, 8.563, 8.578, 8.564],
        [174, 8.579239583, 8.528, 8.498, 8.563, 8.573, 8.56],
        [175, 8.578704861, 8.522, 8.495, 8.566, 8.57, 8.558],
        [176, 8.582045139, 8.52, 8.501, 8.571, 8.572, 8.551],
        [177, 8.594263889, 8.516, 8.516, 8.575, 8.572, 8.543],
        [178, 8.613107639, 8.511, 8.547, 8.573, 8.572, 8.54],
        [179, 8.614013889, 8.506, 8.557, 8.571, 8.571, 8.537],
        [180, 8.615590278, 8.512, 8.563, 8.573, 8.569, 8.535],
        [181, 8.619260417, 8.509, 8.569, 8.57, 8.568, 8.552],
        [182, 8.617767361, 8.518, 8.577, 8.566, 8.56, 8.556],
        [183, 8.615194444, 8.516, 8.575, 8.562, 8.557, 8.553],
        [184, 8.610836806, 8.511, 8.57, 8.557, 8.554, 8.553],
        [185, 8.606163194, 8.507, 8.569, 8.554, 8.55, 8.55],
        [186, 8.601409722, 8.511, 8.573, 8.545, 8.545, 8.543],
        [187, 8.607604167, 8.512, 8.585, 8.543, 8.547, 8.539],
        [188, 8.551135417, 8.505, 8.589, 8.55, 8.536, 8.526],
        [189, 8.543673611, 8.503, 8.602, 8.543, 8.526, 8.517],
        [190, 8.53365625, 8.495, 8.611, 8.54, 8.519, 8.512],
        [191, 8.520100694, 8.488, 8.607, 8.535, 8.512, 8.511],
        [192, 8.508927083, 8.48, 8.603, 8.532, 8.515, 8.504],
        [193, 8.503975694, 8.484, 8.599, 8.535, 8.514, 8.499],
        [194, 8.515163194, 8.482, 8.584, 8.53, 8.505, 8.493],
        [195, 8.509982639, 8.477, 8.577, 8.523, 8.501, 8.502],
        [196, 8.505871528, 8.47, 8.578, 8.517, 8.494, 8.501],
        [197, 8.503770833, 8.464, 8.581, 8.512, 8.491, 8.505],
        [198, 8.492177083, 8.461, 8.572, 8.511, 8.495, 8.511],
        [199, 8.536215278, 8.458, 8.563, 8.507, 8.487, 8.504],
        [200, 8.539024306, 8.451, 8.564, 8.505, 8.485, 8.496],
        [201, 8.560295139, 8.458, 8.578, 8.526, 8.483, 8.493],
        [202, 8.520003472, 8.468, 8.579, 8.532, 8.481, 8.488],
        [203, 8.515996528, 8.464, 8.574, 8.534, 8.476, 8.486],
        [204, 8.509951389, 8.459, 8.572, 8.537, 8.469, 8.48],
        [205, 8.503152778, 8.455, 8.576, 8.541, 8.461, 8.48],
        [206, 8.495423611, 8.45, 8.608, 8.537, 8.456, 8.483],
        [207, 8.492170139, 8.443, 8.604, 8.531, 8.45, 8.479],
        [208, 8.486878472, 8.438, 8.599, 8.527, 8.45, 8.479],
        [209, 8.523850694, 8.441, 8.594, 8.539, 8.466, 8.478],
        [210, 8.515260417, 8.441, 8.588, 8.533, 8.463, 8.474],
        [211, 8.509451389, 8.438, 8.578, 8.531, 8.462, 8.471],
        [212, 8.505465278, 8.432, 8.566, 8.532, 8.459, 8.469],
        [213, 8.500125, 8.429, 8.561, 8.532, 8.454, 8.499],
        [214, 8.494024306, 8.433, 8.548, 8.528, 8.449, 8.513],
        [215, 8.498138889, 8.427, 8.547, 8.541, 8.447, 8.515],
        [216, 8.496920139, 8.426, 8.554, 8.572, 8.442, 8.518],
        [217, 8.4920625, 8.424, 8.552, 8.573, 8.435, 8.516],
        [218, 8.492996528, 8.418, 8.551, 8.566, 8.435, 8.519],
        [219, 8.5165, 8.425, 8.553, 8.565, 8.435, 8.517],
        [220, 8.515708333, 8.442, 8.554, 8.564, 8.438, 8.515],
        [221, 8.5139375, 8.446, 8.575, 8.561, 8.437, 8.516],
        [222, 8.514118056, 8.44, 8.599, 8.562, 8.438, 8.517],
        [223, 8.515451389, 8.435, 8.593, 8.566, 8.433, 8.514],
        [224, 8.539395833, 8.428, 8.606, 8.592, 8.43, 8.512],
        [225, 8.545256944, 8.422, 8.601, 8.586, 8.429, 8.511],
        [226, 8.545694444, 8.418, 8.589, 8.567, 8.424, 8.507],
        [227, 8.543302083, 8.414, 8.578, 8.555, 8.418, 8.505],
        [228, 8.538159722, 8.414, 8.567, 8.541, 8.414, 8.502],
        [229, 8.538440972, 8.421, 8.56, 8.532, 8.413, 8.523],
        [230, 8.545680556, 8.417, 8.554, 8.543, 8.413, 8.527],
        [231, 8.543690972, 8.412, 8.545, 8.552, 8.407, 8.521],
        [232, 8.545041667, 8.409, 8.537, 8.545, 8.404, 8.518],
        [233, 8.53946875, 8.407, 8.53, 8.539, 8.401, 8.536],
        [234, 8.537173611, 8.409, 8.523, 8.55, 8.398, 8.581],
        [235, 8.535826389, 8.409, 8.513, 8.546, 8.392, 8.57],
        [236, 8.533263889, 8.406, 8.511, 8.544, 8.385, 8.566],
        [237, 8.533711806, 8.401, 8.515, 8.54, 8.382, 8.529],
        [238, 8.529427083, 8.402, 8.514, 8.537, 8.377, 8.5],
        [239, 8.524322917, 8.397, 8.511, 8.528, 8.375, 8.489],
        [240, 8.519072917, 8.393, 8.502, 8.54, 8.377, 8.487],
        [241, 8.523715278, 8.39, 8.503, 8.541, 8.373, 8.494],
        [242, 8.52309375, 8.396, 8.505, 8.554, 8.374, 8.486],
        [243, 8.519975694, 8.394, 8.502, 8.56, 8.371, 8.496],
        [244, 8.51671875, 8.387, 8.496, 8.557, 8.367, 8.516],
        [245, 8.514086806, 8.381, 8.487, 8.554, 8.364, 8.541],
        [246, 8.514708333, 8.382, 8.48, 8.57, 8.364, 8.558],
        [247, 8.514583333, 8.38, 8.476, 8.573, 8.388, 8.531],
        [248, 8.5130625, 8.371, 8.478, 8.573, 8.387, 8.501],
        [249, 8.534677083, 8.367, 8.477, 8.57, 8.388, 8.499],
        [250, 8.533232639, 8.362, 8.474, 8.567, 8.39, 8.513],
        [251, 8.527618056, 8.359, 8.473, 8.569, 8.391, 8.531],
        [252, 8.524246528, 8.355, 8.477, 8.571, 8.387, 8.516],
        [253, 8.519940972, 8.352, 8.474, 8.57, 8.385, 8.507],
        [254, 8.523194444, 8.351, 8.468, 8.57, 8.393, 8.504],
        [255, 8.532506944, 8.352, 8.47, 8.55, 8.393, 8.498],
        [256, 8.529763889, 8.356, 8.468, 8.532, 8.396, 8.492],
        [257, 8.525329861, 8.357, 8.467, 8.543, 8.427, 8.484],
        [258, 8.521045139, 8.351, 8.48, 8.547, 8.431, 8.48],
        [259, 8.516743056, 8.354, 8.478, 8.536, 8.433, 8.473],
        [260, 8.513579861, 8.351, 8.475, 8.525, 8.432, 8.465],
        [261, 8.508329861, 8.352, 8.475, 8.518, 8.432, 8.46],
        [262, 8.501513889, 8.373, 8.471, 8.504, 8.43, 8.449],
        [263, 8.496486111, 8.379, 8.467, 8.489, 8.43, 8.462],
        [264, 8.492309028, 8.377, 8.468, 8.479, 8.431, 8.462],
        [265, 8.488572917, 8.377, 8.533, 8.477, 8.436, 8.462],
        [266, 8.485565972, 8.368, 8.601, 8.478, 8.473, 8.455],
        [267, 8.481829861, 8.364, 8.617, 8.474, 8.48, 8.443],
        [268, 8.477128472, 8.367, 8.636, 8.471, 8.482, 8.443],
        [269, 8.471350694, 8.392, 8.665, 8.467, 8.49, 8.463],
        [270, 8.465350694, 8.401, 8.673, 8.462, 8.49, 8.46],
        [271, 8.460041667, 8.402, 8.67, 8.457, 8.498, 8.457],
        [272, 8.456135417, 8.399, 8.663, 8.458, 8.5, 8.455],
        [273, 8.452940972, 8.398, 8.654, 8.467, 8.499, 8.446],
        [274, 8.451375, 8.4, 8.638, 8.472, 8.5, 8.436],
        [275, 8.44815625, 8.397, 8.639, 8.468, 8.491, 8.426],
        [276, 8.44565625, 8.39, 8.675, 8.453, 8.478, 8.415],
        [277, 8.442704861, 8.388, 8.675, 8.442, 8.468, 8.438],
        [278, 8.447048611, 8.387, 8.668, 8.435, 8.457, 8.441],
        [279, 8.442770833, 8.388, 8.659, 8.426, 8.445, 8.434],
        [280, 8.440517361, 8.395, 8.648, 8.415, 8.439, 8.433],
        [281, 8.447479167, 8.389, 8.637, 8.417, 8.434, 8.433],
        [282, 8.455548611, 8.389, 8.629, 8.41, 8.427, 8.438],
        [283, 8.454565972, 8.385, 8.63, 8.401, 8.42, 8.455],
        [284, 8.454184028, 8.384, 8.632, 8.393, 8.411, 8.459],
        [285, 8.451163194, 8.389, 8.629, 8.385, 8.404, 8.45],
        [286, 8.447888889, 8.419, 8.644, 8.374, 8.398, 8.435],
        [287, 8.442493056, 8.428, 8.644, 8.371, 8.397, 8.423],
        [288, 8.437940972, 8.432, 8.641, 8.367, 8.392, 8.417],
        [289, 8.431159722, 8.442, 8.654, 8.363, 8.407, 8.411],
        [290, 8.425607639, 8.436, 8.654, 8.36, 8.418, 8.401],
        [291, 8.419798611, 8.428, 8.65, 8.358, 8.414, 8.384],
        [292, 8.414965278, 8.426, 8.641, 8.359, 8.41, 8.37],
        [293, 8.413621528, 8.428, 8.633, 8.37, 8.405, 8.375],
        [294, 8.406600694, 8.423, 8.639, 8.367, 8.402, 8.367],
        [295, 8.398298611, 8.418, 8.648, 8.373, 8.413, 8.358],
        [296, 8.392229167, 8.413, 8.643, 8.377, 8.414, 8.351],
        [297, 8.389166667, 8.408, 8.638, 8.386, 8.417, 8.346],
        [298, 8.388756944, 8.403, 8.637, 8.399, 8.414, 8.337],
        [299, 8.402559028, 8.398, 8.626, 8.397, 8.409, 8.331],
        [300, 8.454836806, 8.393, 8.616, 8.393, 8.428, 8.323],
        [301, 8.490868056, 8.386, 8.605, 8.387, 8.437, 8.318],
        [302, 8.494159722, 8.379, 8.594, 8.379, 8.43, 8.314],
        [303, 8.492788194, 8.374, 8.583, 8.379, 8.423, 8.308],
        [304, 8.493378472, 8.369, 8.57, 8.368, 8.432, 8.316],
        [305, 8.487756944, 8.365, 8.558, 8.357, 8.441, 8.317],
        [306, 8.482305556, 8.36, 8.548, 8.355, 8.441, 8.316],
        [307, 8.481631944, 8.354, 8.537, 8.357, 8.448, 8.309],
        [308, 8.479229167, 8.349, 8.525, 8.351, 8.453, 8.304],
        [309, 8.474923611, 8.348, 8.514, 8.345, 8.47, 8.299],
        [310, 8.484677083, 8.348, 8.503, 8.341, 8.474, 8.305],
        [311, 8.491552083, 8.34, 8.493, 8.338, 8.477, 8.325],
        [312, 8.493961806, 8.336, 8.485, 8.334, 8.47, 8.333],
        [313, 8.496045139, 8.327, 8.477, 8.33, 8.463, 8.333],
        [314, 8.494597222, 8.322, 8.467, 8.325, 8.462, 8.34],
        [315, 8.49003125, 8.32, 8.459, 8.321, 8.454, 8.341],
        [316, 8.48421875, 8.314, 8.452, 8.324, 8.442, 8.34],
        [317, 8.479840278, 8.306, 8.451, 8.323, 8.432, 8.336],
        [318, 8.475361111, 8.299, 8.448, 8.316, 8.424, 8.328],
        [319, 8.470680556, 8.295, 8.441, 8.311, 8.42, 8.321],
        [320, 8.467274306, 8.289, 8.434, 8.312, 8.413, 8.325],
        [321, 8.473336806, 8.283, 8.427, 8.339, 8.403, 8.322],
        [322, 8.469611111, 8.278, 8.425, 8.342, 8.394, 8.315],
        [323, 8.465107639, 8.274, 8.419, 8.338, 8.387, 8.311],
        [324, 8.459788194, 8.276, 8.412, 8.332, 8.38, 8.306],
        [325, 8.463444444, 8.269, 8.407, 8.328, 8.375, 8.303],
        [326, 8.461152778, 8.266, 8.409, 8.324, 8.379, 8.294],
        [327, 8.455649306, 8.263, 8.404, 8.32, 8.374, 8.285],
        [328, 8.448194444, 8.259, 8.397, 8.318, 8.369, 8.279],
        [329, 8.441972222, 8.263, 8.397, 8.313, 8.364, 8.279],
        [330, 8.440798611, 8.261, 8.399, 8.311, 8.36, 8.283],
        [331, 8.439395833, 8.262, 8.394, 8.313, 8.371, 8.293],
        [332, 8.43265625, 8.265, 8.387, 8.314, 8.383, 8.29],
        [333, 8.430590278, 8.263, 8.38, 8.313, 8.379, 8.286],
        [334, 8.426829861, 8.271, 8.375, 8.311, 8.37, 8.281],
        [335, 8.418309028, 8.28, 8.371, 8.307, 8.378, 8.276],
        [336, 8.417732639, 8.28, 8.373, 8.309, 8.36, 8.284],
        [337, 8.417246528, 8.286, 8.373, 8.312, 8.35, 8.294],
        [338, 8.4130625, 8.293, 8.37, 8.308, 8.348, 8.288],
        [339, 8.407913194, 8.294, 8.367, 8.307, 8.343, 8.286],
        [340, 8.403114583, 8.295, 8.372, 8.304, 8.336, 8.288],
        [341, 8.400986111, 8.302, 8.371, 8.295, 8.328, 8.283],
        [342, 8.396166667, 8.304, 8.367, 8.291, 8.32, 8.278],
        [343, 8.395416667, 8.306, 8.363, 8.284, 8.322, 8.272],
        [344, 8.394996528, 8.3, 8.361, 8.28, 8.33, 8.267],
        [345, 8.392059028, 8.296, 8.371, 8.275, 8.325, 8.263],
        [346, 8.392375, 8.293, 8.384, 8.27, 8.32, 8.259],
        [347, 8.388131944, 8.288, 8.386, 8.277, 8.315, 8.253],
        [348, 8.383104167, 8.285, 8.386, 8.286, 8.311, 8.247],
        [349, 8.382392361, 8.284, 8.386, 8.281, 8.309, 8.243],
        [350, 8.379413194, 8.288, 8.383, 8.275, 8.303, 8.237],
        [351, 8.388784722, 8.289, 8.39, 8.269, 8.297, 8.23],
        [352, 8.395892361, 8.292, 8.392, 8.262, 8.293, 8.224],
        [353, 8.395690972, 8.291, 8.39, 8.254, 8.286, 8.218],
        [354, 8.400409722, 8.288, 8.386, 8.249, 8.28, 8.213],
        [355, 8.392743056, 8.285, 8.387, 8.248, 8.273, 8.229],
        [356, 8.38740625, 8.283, 8.386, 8.245, 8.267, 8.232],
        [357, 8.385284722, 8.284, 8.381, 8.24, 8.261, 8.231],
        [358, 8.382638889, 8.286, 8.377, 8.236, 8.255, 8.232],
        [359, 8.380159722, 8.285, 8.378, 8.238, 8.249, 8.229],
        [360, 8.378201389, 8.282, 8.376, 8.245, 8.242, 8.225],
        [361, 8.381048611, 8.281, 8.372, 8.246, 8.238, 8.221],
        [362, 8.38396875, 8.287, 8.369, 8.243, 8.233, 8.232],
        [363, 8.376135417, 8.286, 8.365, 8.247, 8.227, 8.233],
        [364, 8.380538194, 8.288, 8.361, 8.245, 8.224, 8.231],
        [365, 8.380402439, 8.293, 8.358, 8.244, 8.224, 8.229]
    ]

    df = pd.DataFrame(historical_water_data_array,
                      columns=['Day', '2023', '2022', '2021', '2020', '2019', '2018'])

    df['2023'] = df['2023'] + 320.85
    df['2022'] = df['2022'] + 320.85
    df['2021'] = df['2021'] + 320.85
    df['2020'] = df['2020'] + 320.85
    df['2019'] = df['2019'] + 320.85
    df['2018'] = df['2018'] + 320.85

    return df


@st.cache_data
def get_recent_level_data():
    todays_date = datetime.today()

    year = todays_date.year

    # year = 2023

    start_string = str(year-1) + '-01-01 00:00:00'

    time_now_string = datetime.now().strftime('%Y-%m-%d %H:%M:%S')

    # time_now_string = "2023-12-30 00:00:00"

    download_url = 'https://wateroffice.ec.gc.ca/services/real_time_data/csv/inline?stations[]=02EA020&parameters[]=46&start_date=' + start_string + '&end_date=' + time_now_string

    r = requests.get(download_url)

    ZWNBSP_delimiter = ' '
    csv_after_split = r.text.split(ZWNBSP_delimiter)[1]

    list_of_csv = csv_after_split.split('\r\n')
    headers = list_of_csv[0].split(',')
    list_of_csv.pop(0)
    list_to_pass_to_df = []
    for list_item in list_of_csv:
        list_to_pass_to_df.append(list_item.split(','))
    df = pd.DataFrame(list_to_pass_to_df, columns=headers)
    df['Date'] = pd.to_datetime(df['Date'])
    df['Day'] = df['Date'].dt.dayofyear - 1

    df['Level'] = df['Value/Valeur'].astype(float).fillna(0.0) + 320.85

    return df


# get the required data
df_target = get_target_values().head(365)
df_historical = get_historical_data().head(365)

# condition the data to prepare for display

# create plotly plots
fig = go.Figure()
# fig = make_subplots(rows=2, cols=1, shared_xaxes=True, vertical_spacing=0.01, row_heights=[0.8, 0.2])
# df_target['Date'] = df_target['Day']

fig.add_trace(go.Scatter(x=df_target['Month'], y=df_target['Top of High'], name='Top of High Water Zone', line_color='Red'))
fig.add_trace(go.Scatter(x=df_target['Month'], y=df_target['Top of Normal'], name='Top of Normal Operating Zone', line_color='Purple'))
fig.add_trace(go.Scatter(x=df_target['Month'], y=df_target['Target'], name='Target Operating Level', line_color='Green'))
fig.add_trace(go.Scatter(x=df_target['Month'], y=df_target['Best Practice'], name='Best Practice', line=dict(color='Green', dash='dash')))
fig.add_trace(go.Scatter(x=df_target['Month'], y=df_target['Bottom of Normal'], name='Bottom of Normal Operating Zone', line=dict(color='Purple', dash='dash')))
fig.add_trace(go.Scatter(x=df_target['Month'], y=df_target['Bottom of Low'], name='Bottom of Low Water Zone', line=dict(color='Red', dash='dash')))

fig.add_trace(go.Scatter(x=df_target['Month'], y=df_historical['2023'], name='2023', marker=dict(
    color='Blue',
    size=4
)))

fig.add_trace(go.Scatter(x=df_target['Month'], y=df_historical['2022'], name='2022', marker=dict(
    color='Blue',
    size=4
)))

fig.add_trace(go.Scatter(x=df_target['Month'], y=df_historical['2021'], name='2021', marker=dict(
    color='Blue',
    size=4
)))

fig.add_trace(go.Scatter(x=df_target['Month'], y=df_historical['2020'], name='2020', marker=dict(
    color='Blue',
    size=4
)))

fig.add_trace(go.Scatter(x=df_target['Month'], y=df_historical['2019'], name='2019', marker=dict(
    color='Blue',
    size=4
)))

# fig.append_trace(
#         go.Line(x=df_historical['Date'], y=df_precip['Total Precip (mm)'].to_list(), name='Precipitation'),
#         row=2,
#         col=1
#     )

# plot via streamlit
st.plotly_chart(fig)

print('Done')
